Fri Aug 15 14:21:34 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.133.20             Driver Version: 570.133.20     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA A100-SXM4-40GB          On  |   00000000:31:00.0 Off |                    0 |
| N/A   45C    P0             52W /  300W |      27MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   1  NVIDIA A100-SXM4-40GB          On  |   00000000:4B:00.0 Off |                    0 |
| N/A   45C    P0             57W /  300W |      27MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   2  NVIDIA A100-SXM4-40GB          On  |   00000000:CA:00.0 Off |                    0 |
| N/A   44C    P0             54W /  300W |      27MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   3  NVIDIA A100-SXM4-40GB          On  |   00000000:E3:00.0 Off |                    0 |
| N/A   46C    P0             57W /  300W |      27MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|    0   N/A  N/A            2634      G   /usr/libexec/Xorg                        17MiB |
|    1   N/A  N/A            2634      G   /usr/libexec/Xorg                        17MiB |
|    2   N/A  N/A            2634      G   /usr/libexec/Xorg                        17MiB |
|    3   N/A  N/A            2634      G   /usr/libexec/Xorg                        17MiB |
+-----------------------------------------------------------------------------------------+
=== BFM EEG Pre-training Job Started ===
Job started on hkn0420.localdomain at Fri Aug 15 02:21:35 PM CEST 2025
Current working directory: /home/hk-project-p0022560/tum_fmp0582/ict/bfm_iclr
Job ID: 3424669
Master Addr: hkn0420
Master Port: 29500
=== Environment Setup Complete ===
CUDA available: True
GPU count: 4
=== Starting EEG Model Pre-training ===
GpuFreq=control_disabled
GpuFreq=control_disabled
GpuFreq=control_disabled
GpuFreq=control_disabled
DDP初始化成功: rank=0, local_rank=0, world_size=16
使用设备: cuda:0
可用GPU数量: 4
  GPU 0: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 1: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 2: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 3: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB

=== 模型配置信息 ===
num_regions: 5
max_electrodes_per_region: 24
sequence_length: 1600
embed_dim: 256
num_heads: 16
depth: 12
mlp_ratio: 4.0
drop_rate: 0.2
attn_drop_rate: 0.2
drop_path_rate: 0.2
use_abs_pos: False
use_rel_pos: True
use_time_embed: True
mask_ratio: 0.15
freq_mask_ratio: 0.3
mask_strategy: random
mask_noise_ratio: 0.005
use_moe: True
num_experts: 8
top_k_experts: 2
moe_aux_loss_coeff: 0.01
n_freq_bands: 5
freq_loss_weight: 0.1
time_loss_weight: 0.9
lr: 3e-05
weight_decay: 0.0001
warmup_epochs: 10
use_amp: True
clip_grad: 1.0
batch_size: 8
use_layer_norm: True
use_batch_norm: True
eps: 1e-08
init_std: 0.02
electrode_names: ['Fp1', 'Fp2', 'F3', 'F4', 'F7', 'F8', 'Fz', 'C3', 'C4', 'Cz', 'P3', 'P4', 'P7', 'P8', 'Pz', 'O1', 'O2', 'Oz', 'T3', 'T4', 'T5', 'T6']
region_names: ['frontal', 'central', 'parietal', 'temporal', 'occipital']
debug: False
freq_eval: True
use_channel_embed: True
channel_embed_dim: 32
num_brain_regions: 5
channel_gat_initial_dim: 32
intra_region_gat_heads: 4
intra_region_gat_dim_per_head: 32
region_agg_attention_dim: 64
inter_region_gat_heads: 4
inter_region_gat_dim_per_head: 64
模型已创建并移动到设备: cuda:0
模型已使用DDP封装在设备 0
优化器已创建，学习率: 3e-05
DDP训练，世界大小: 16, 有效批次大小: 128
动态梯度累积设置:
  目标全局批次大小: 128
  当前全局批次大小: 128
  梯度累积步数: 1
  实际有效全局批次大小: 128
训练器已创建

============================================================
                           模型参数统计                           
============================================================
总参数量:                57,275,792
可训练参数:               57,275,792
冻结参数:                0
参数大小:                218.49 MB (FP32)
参数大小:                109.24 MB (FP16)

------------------------------------------------------------
                          主要模块参数分布                          
------------------------------------------------------------
region_projection.raw_projection.0          819,712 (  1.4%)
time_reconstruction_head1                   411,200 (  0.7%)
time_reconstruction_head2                   411,200 (  0.7%)
fusion_module.mlp_t.0                       263,168 (  0.5%)
fusion_module.mlp_f.0                       263,168 (  0.5%)
layers.0.mlp.experts.0.0                    263,168 (  0.5%)
layers.0.mlp.experts.1.0                    263,168 (  0.5%)
layers.0.mlp.experts.2.0                    263,168 (  0.5%)
layers.0.mlp.experts.3.0                    263,168 (  0.5%)
layers.0.mlp.experts.4.0                    263,168 (  0.5%)
其他模块                                     53,396,490 ( 93.2%)
============================================================

正在加载数据: /hkfs/work/workspace/scratch/tum_fmp0582-ictspace/processed_data2
检测到合并文件 BCI_Competition_IV-1_data.h5，包含 7 个数据集
检测到合并文件 Emobrain_data_data.h5，包含 15 个数据集
检测到合并文件 REEG-BACA_data.h5，包含 3264 个数据集
检测到合并文件 Raw_EEG_Data_data.h5，包含 20 个数据集
检测到合并文件 Resting_State_EEG_Data_data.h5，包含 22 个数据集
检测到合并文件 SEED-V_data.h5，包含 48 个数据集
检测到合并文件 SEED_FRA_data.h5，包含 24 个数据集
检测到合并文件 Siena_Scalp_EEG_Database_data.h5，包含 40 个数据集
检测到合并文件 TDBrain_data.h5，包含 2518 个数据集
检测到合并文件 TUAR_data.h5，包含 310 个数据集
检测到合并文件 TUEP_data.h5，包含 2298 个数据集
检测到合并文件 TUH1.h5，包含 6968 个数据集
检测到合并文件 TUH10.h5，包含 6960 个数据集
检测到合并文件 TUH2.h5，包含 6968 个数据集
检测到合并文件 TUH3.h5，包含 6968 个数据集
检测到合并文件 TUH4.h5，包含 6968 个数据集
检测到合并文件 TUH5.h5，包含 6968 个数据集
检测到合并文件 TUH6.h5，包含 6968 个数据集
检测到合并文件 TUH7.h5，包含 6968 个数据集
检测到合并文件 TUH8.h5，包含 6968 个数据集
检测到合并文件 TUH9.h5，包含 6968 个数据集
检测到合并文件 TUSL_data.h5，包含 88 个数据集
检测到合并文件 TUSZ_data.h5，包含 7276 个数据集
检测到合并文件 Workload_data.h5，包含 72 个数据集
有效数据源: 85675, 来自 25 个文件, 跳过文件数量: 0
数据集初始化完成: 共25个文件, 85675个数据源, 总样本数: 53235406
警告: num_workers=24 可能过高，建议设置为16以下
数据加载配置: num_workers=24, 服务器CPU核心充足
数据加载器已创建: 样本数=53235406, 批次大小=8

==================================================
开始训练 DualDomain Neural Transformer MEM 模型
共100个周期，批次大小:8
==================================================

学习率调度器已初始化，总训练epochs: 100, 每个epoch的步数: 415902
总训练步数: 41590200
学习率调度器设置成功
警告: 未找到TensorBoard，将不会记录训练日志

==================================================
     DualDomain Neural Transformer MEM 模型训练开始     
==================================================
                     本次运行文件夹                      
--------------------------------------------------
运行文件夹:          checkpoint/20250815_142207
最佳模型:           checkpoint/20250815_142207/best_model.pt
最后模型:           checkpoint/20250815_142207/last_model.pt
--------------------------------------------------
                      模型参数统计                      
--------------------------------------------------
总参数量:           57,275,792
可训练参数:          57,275,792
冻结参数:           0
内存占用(FP32):     218.5 MB
内存占用(FP16):     109.2 MB

                     主要组件参数分布                     
--------------------------------------------------
layers                 53,640,192 ( 93.7%)
fusion_module           1,711,360 (  3.0%)
region_projection       1,060,358 (  1.9%)
time_reconstruction_head1      411,200 (  0.7%)
time_reconstruction_head2      411,200 (  0.7%)
positional_embedding       30,720 (  0.1%)
intra_region_pos_embedding        6,144 (  0.0%)
freq_reconstruction_head1        1,285 (  0.0%)
freq_reconstruction_head2        1,285 (  0.0%)
region_embedding            1,280 (  0.0%)
norm                          512 (  0.0%)

                      训练配置信息                      
--------------------------------------------------
训练周期:           100
批次大小:           8
有效批次大小:         128
设备:             cuda:0
DDP世界大小:        16
DDP模式:          启用
学习率:            3e-05
时域损失权重:         0.9
频域损失权重:         0.1
混合精度:           启用
梯度累积步数:         1
每个周期的步数:        415902
==================================================


Epoch 1/100
--------------------------------------------------
序列长度 (R*E): 120
时域预测形状: torch.Size([8, 120, 1600]), 目标形状: torch.Size([8, 120, 1600])
频域预测形状: torch.Size([8, 120, 5]), 目标形状: torch.Size([8, 120, 5])
训练进度: [=                   ] 1/415902 | 总损失: 0.12127727 | 时域: 0.46249974 | 频域: 4.24708605 | LR: 0.00000060 | 用时: 9.4秒训练进度: [=                   ] 20796/415902 | 总损失: 0.04457363 | 时域: 0.13166417 | 频域: 1.89022040 | LR: 0.00000060 | 用时: 6966.5秒训练进度: [==                  ] 41591/415902 | 总损失: 0.04110952 | 时域: 0.13741362 | 频域: 1.49916041 | LR: 0.00000060 | 用时: 13882.5秒训练进度: [===                 ] 62386/415902 | 总损失: 0.05393935 | 时域: 0.28371412 | 频域: 1.46812057 | LR: 0.00000060 | 用时: 20758.1秒训练进度: [====                ] 83181/415902 | 总损失: 0.03864058 | 时域: 0.12200636 | 频域: 1.39429641 | LR: 0.00000060 | 用时: 27659.0秒训练进度: [=====               ] 103976/415902 | 总损失: 0.03741967 | 时域: 0.12600607 | 频域: 1.24364281 | LR: 0.00000060 | 用时: 34541.1秒训练进度: [======              ] 124771/415902 | 总损失: 0.03575495 | 时域: 0.12592228 | 频域: 1.07439017 | LR: 0.00000060 | 用时: 41435.2秒训练进度: [=======             ] 145566/415902 | 总损失: 0.03668242 | 时域: 0.14019088 | 频域: 1.03469074 | LR: 0.00000060 | 用时: 48341.0秒训练进度: [========            ] 166361/415902 | 总损失: 0.03507589 | 时域: 0.12673056 | 频域: 0.99558735 | LR: 0.00000060 | 用时: 55250.3秒训练进度: [=========           ] 187156/415902 | 总损失: 0.03324064 | 时域: 0.11618936 | 频域: 0.90827084 | LR: 0.00000061 | 用时: 62133.5秒训练进度: [==========          ] 207951/415902 | 总损失: 0.03233495 | 时域: 0.11022273 | 频域: 0.87978268 | LR: 0.00000061 | 用时: 69010.8秒训练进度: [===========         ] 228746/415902 | 总损失: 0.03147078 | 时域: 0.12014779 | 频域: 0.70243728 | LR: 0.00000061 | 用时: 75905.7秒训练进度: [============        ] 249541/415902 | 总损失: 0.03340375 | 时域: 0.13173385 | 频域: 0.79120952 | LR: 0.00000061 | 用时: 82788.3秒训练进度: [=============       ] 270336/415902 | 总损失: 0.03350412 | 时域: 0.13698700 | 频域: 0.76121926 | LR: 0.00000061 | 用时: 89687.7秒训练进度: [==============      ] 291131/415902 | 总损失: 0.03279965 | 时域: 0.13287143 | 频域: 0.72534049 | LR: 0.00000061 | 用时: 96605.7秒训练进度: [===============     ] 311926/415902 | 总损失: 0.03672462 | 时域: 0.17712153 | 频域: 0.71783471 | LR: 0.00000062 | 用时: 103514.3秒训练进度: [================    ] 332721/415902 | 总损失: 0.04473067 | 时域: 0.26657751 | 频域: 0.71589524 | LR: 0.00000062 | 用时: 110420.6秒训练进度: [=================   ] 353516/415902 | 总损失: 0.03584081 | 时域: 0.17868224 | 频域: 0.61823624 | LR: 0.00000062 | 用时: 117328.3秒训练进度: [==================  ] 374311/415902 | 总损失: 0.03392278 | 时域: 0.14902343 | 频域: 0.69454998 | LR: 0.00000062 | 用时: 124223.7秒训练进度: [=================== ] 395106/415902 | 总损失: 0.02970481 | 时域: 0.10940333 | 频域: 0.62704509 | LR: 0.00000063 | 用时: 131119.1秒训练进度: [====================] 415901/415902 | 总损失: 0.02885896 | 时域: 0.10484739 | 频域: 0.57863986 | LR: 0.00000063 | 用时: 138008.4秒训练进度: [====================] 415902/415902 | 总损失: 0.02597010 | 时域: 0.07969636 | 频域: 0.52111602 | LR: 0.00000063 | 用时: 138009.6秒
--------------------------------------------------
                     Epoch 总结                     
训练总损失:          0.03716922
训练时域损失:         0.14989154
训练频域损失:         0.99327922
训练相位损失:         0.17710732
当前学习率:          0.00000063
本轮用时:           138009.7秒
--------------------------------------------------

Epoch 2/100
--------------------------------------------------
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.

============================= JOB FEEDBACK =============================

Job ID: 3424669
Cluster: hk
User/Group: tum_fmp0582/hk-project-p0022560
Account: hk-project-p0022560
State: TIMEOUT (exit code 0)
Partition: accelerated
Nodes: 4
Cores per node: 128
Nodelist: hkn[0420,0423,0608,0721]
CPU Utilized: 37-07:59:28
CPU Efficiency: 3.65% of 1024-04:07:28 core-walltime
Job Wall-clock time: 2-00:00:29
Starttime: Fri Aug 15 14:21:05 2025
Endtime: Sun Aug 17 14:21:34 2025
Memory Utilized: 632.54 GB (estimated maximum)
Memory Efficiency: 0.00% of 0.00 MB (0.00 MB/node)
Energy Consumed: 574830593 Joule / 159675.164722222 Watthours
Average node power draw: 3326.00774754237 Watt
