GpuFreq=control_disabled
GpuFreq=control_disabled
GpuFreq=control_disabled
GpuFreq=control_disabled
DDP初始化成功: rank=0, local_rank=0, world_size=16
使用设备: cuda:0
可用GPU数量: 4
  GPU 0: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 1: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 2: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 3: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB

=== 模型配置信息 ===
num_regions: 5
max_electrodes_per_region: 24
sequence_length: 1600
embed_dim: 256
num_heads: 16
depth: 12
mlp_ratio: 4.0
drop_rate: 0.2
attn_drop_rate: 0.2
drop_path_rate: 0.2
use_abs_pos: False
use_rel_pos: True
use_time_embed: True
mask_ratio: 0.15
freq_mask_ratio: 0.3
mask_strategy: random
mask_noise_ratio: 0.005
use_moe: True
num_experts: 8
top_k_experts: 2
moe_aux_loss_coeff: 0.01
n_freq_bands: 5
freq_loss_weight: 0.1
time_loss_weight: 0.9
lr: 3e-05
weight_decay: 0.0001
warmup_epochs: 10
use_amp: True
clip_grad: 1.0
batch_size: 8
use_layer_norm: True
use_batch_norm: True
eps: 1e-08
init_std: 0.02
electrode_names: ['Fp1', 'Fp2', 'F3', 'F4', 'F7', 'F8', 'Fz', 'C3', 'C4', 'Cz', 'P3', 'P4', 'P7', 'P8', 'Pz', 'O1', 'O2', 'Oz', 'T3', 'T4', 'T5', 'T6']
region_names: ['frontal', 'central', 'parietal', 'temporal', 'occipital']
debug: False
freq_eval: True
use_channel_embed: True
channel_embed_dim: 32
num_brain_regions: 5
channel_gat_initial_dim: 32
intra_region_gat_heads: 4
intra_region_gat_dim_per_head: 32
region_agg_attention_dim: 64
inter_region_gat_heads: 4
inter_region_gat_dim_per_head: 64
模型已创建并移动到设备: cuda:0
模型已使用DDP封装在设备 0
优化器已创建，学习率: 3e-05
DDP训练，世界大小: 16, 有效批次大小: 128
动态梯度累积设置:
  目标全局批次大小: 128
  当前全局批次大小: 128
  梯度累积步数: 1
  实际有效全局批次大小: 128
训练器已创建

============================================================
                           模型参数统计                           
============================================================
总参数量:                57,275,792
可训练参数:               57,275,792
冻结参数:                0
参数大小:                218.49 MB (FP32)
参数大小:                109.24 MB (FP16)

------------------------------------------------------------
                          主要模块参数分布                          
------------------------------------------------------------
region_projection.raw_projection.0          819,712 (  1.4%)
time_reconstruction_head1                   411,200 (  0.7%)
time_reconstruction_head2                   411,200 (  0.7%)
fusion_module.mlp_t.0                       263,168 (  0.5%)
fusion_module.mlp_f.0                       263,168 (  0.5%)
layers.0.mlp.experts.0.0                    263,168 (  0.5%)
layers.0.mlp.experts.1.0                    263,168 (  0.5%)
layers.0.mlp.experts.2.0                    263,168 (  0.5%)
layers.0.mlp.experts.3.0                    263,168 (  0.5%)
layers.0.mlp.experts.4.0                    263,168 (  0.5%)
其他模块                                     53,396,490 ( 93.2%)
============================================================

正在加载数据: /hkfs/work/workspace/scratch/tum_fmp0582-ictspace/processed_data2
检测到合并文件 BCI_Competition_IV-1_data.h5，包含 7 个数据集
检测到合并文件 Emobrain_data_data.h5，包含 15 个数据集
检测到合并文件 REEG-BACA_data.h5，包含 3264 个数据集
检测到合并文件 Raw_EEG_Data_data.h5，包含 20 个数据集
检测到合并文件 Resting_State_EEG_Data_data.h5，包含 22 个数据集
检测到合并文件 SEED-V_data.h5，包含 48 个数据集
检测到合并文件 SEED_FRA_data.h5，包含 24 个数据集
检测到合并文件 Siena_Scalp_EEG_Database_data.h5，包含 40 个数据集
检测到合并文件 TDBrain_data.h5，包含 2518 个数据集
检测到合并文件 TUAR_data.h5，包含 310 个数据集
检测到合并文件 TUEP_data.h5，包含 2298 个数据集
检测到合并文件 TUH1.h5，包含 6968 个数据集
检测到合并文件 TUH10.h5，包含 6960 个数据集
检测到合并文件 TUH2.h5，包含 6968 个数据集
检测到合并文件 TUH3.h5，包含 6968 个数据集
检测到合并文件 TUH4.h5，包含 6968 个数据集
检测到合并文件 TUH5.h5，包含 6968 个数据集
检测到合并文件 TUH6.h5，包含 6968 个数据集
检测到合并文件 TUH7.h5，包含 6968 个数据集
检测到合并文件 TUH8.h5，包含 6968 个数据集
检测到合并文件 TUH9.h5，包含 6968 个数据集
检测到合并文件 TUSL_data.h5，包含 88 个数据集
检测到合并文件 TUSZ_data.h5，包含 7276 个数据集
检测到合并文件 Workload_data.h5，包含 72 个数据集
全局扫描完成: 共找到 25 个文件, 53235406 个总样本。
DDP已启用，对 53235406 个样本进行分片。Rank 0 分配到 3327213 个样本。
数据集初始化完成: 当前进程样本数: 3327213
警告: num_workers=24 可能过高，建议设置为16以下
数据加载配置: num_workers=24, 服务器CPU核心充足
数据加载器已创建: 样本数=3327213, 批次大小=8

==================================================
开始训练 DualDomain Neural Transformer MEM 模型
共100个周期，批次大小:8
==================================================

学习率调度器已初始化，总训练epochs: 100, 每个epoch的步数: 415902
总训练步数: 41590200
学习率调度器设置成功
警告: 未找到TensorBoard，将不会记录训练日志

==================================================
     DualDomain Neural Transformer MEM 模型训练开始     
==================================================
                     本次运行文件夹                      
--------------------------------------------------
运行文件夹:          checkpoint/20250817_145527
最佳模型:           checkpoint/20250817_145527/best_model.pt
最后模型:           checkpoint/20250817_145527/last_model.pt
--------------------------------------------------
                      模型参数统计                      
--------------------------------------------------
总参数量:           57,275,792
可训练参数:          57,275,792
冻结参数:           0
内存占用(FP32):     218.5 MB
内存占用(FP16):     109.2 MB

                     主要组件参数分布                     
--------------------------------------------------
layers                 53,640,192 ( 93.7%)
fusion_module           1,711,360 (  3.0%)
region_projection       1,060,358 (  1.9%)
time_reconstruction_head1      411,200 (  0.7%)
time_reconstruction_head2      411,200 (  0.7%)
positional_embedding       30,720 (  0.1%)
intra_region_pos_embedding        6,144 (  0.0%)
freq_reconstruction_head1        1,285 (  0.0%)
freq_reconstruction_head2        1,285 (  0.0%)
region_embedding            1,280 (  0.0%)
norm                          512 (  0.0%)

                      训练配置信息                      
--------------------------------------------------
训练周期:           100
批次大小:           8
有效批次大小:         128
设备:             cuda:0
DDP世界大小:        16
DDP模式:          启用
学习率:            3e-05
时域损失权重:         0.9
频域损失权重:         0.1
混合精度:           启用
梯度累积步数:         1
每个周期的步数:        415902
==================================================


Epoch 1/100
--------------------------------------------------
序列长度 (R*E): 120
时域预测形状: torch.Size([8, 120, 1600]), 目标形状: torch.Size([8, 120, 1600])
频域预测形状: torch.Size([8, 120, 5]), 目标形状: torch.Size([8, 120, 5])
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
srun: got SIGCONT
