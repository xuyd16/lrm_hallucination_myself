Thu Jul 24 17:43:07 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.133.20             Driver Version: 570.133.20     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA H100                    On  |   00000000:06:00.0 Off |                    0 |
| N/A   41C    P0             68W /  415W |      27MiB /  95830MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   1  NVIDIA H100                    On  |   00000000:26:00.0 Off |                    0 |
| N/A   41C    P0             68W /  415W |      27MiB /  95830MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   2  NVIDIA H100                    On  |   00000000:A6:00.0 Off |                    0 |
| N/A   42C    P0             67W /  415W |      27MiB /  95830MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   3  NVIDIA H100                    On  |   00000000:C6:00.0 Off |                    0 |
| N/A   41C    P0             70W /  415W |      27MiB /  95830MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|    0   N/A  N/A            3078      G   /usr/libexec/Xorg                        17MiB |
|    1   N/A  N/A            3078      G   /usr/libexec/Xorg                        17MiB |
|    2   N/A  N/A            3078      G   /usr/libexec/Xorg                        17MiB |
|    3   N/A  N/A            3078      G   /usr/libexec/Xorg                        17MiB |
+-----------------------------------------------------------------------------------------+
=== BFM EEG Pre-training Job Started ===
Job started on hkn0904.localdomain at Thu Jul 24 05:43:08 PM CEST 2025
Current working directory: /home/hk-project-p0022560/tum_fmp0582/ict/bfm_iclr
Job ID: 3372647
Master Addr: hkn0904
Master Port: 29500
=== Environment Setup Complete ===
CUDA available: True
GPU count: 4
=== Starting EEG Model Pre-training ===
GpuFreq=control_disabled
GpuFreq=control_disabled
DDP初始化成功: rank=0, local_rank=0, world_size=8
使用设备: cuda:0
可用GPU数量: 4
  GPU 0: NVIDIA H100
    显存: 93.1 GB
  GPU 1: NVIDIA H100
    显存: 93.1 GB
  GPU 2: NVIDIA H100
    显存: 93.1 GB
  GPU 3: NVIDIA H100
    显存: 93.1 GB

=== 模型配置信息 ===
num_regions: 5
max_electrodes_per_region: 24
sequence_length: 1600
embed_dim: 768
num_heads: 32
depth: 28
mlp_ratio: 4.0
drop_rate: 0.2
attn_drop_rate: 0.2
drop_path_rate: 0.2
use_abs_pos: False
use_rel_pos: True
use_time_embed: True
mask_ratio: 0.15
freq_mask_ratio: 0.3
mask_strategy: random
mask_noise_ratio: 0.005
use_moe: True
num_experts: 16
top_k_experts: 2
moe_aux_loss_coeff: 0.01
n_freq_bands: 5
freq_loss_weight: 0.1
time_loss_weight: 0.9
lr: 0.0001
weight_decay: 0.0001
warmup_epochs: 5
use_amp: True
clip_grad: 0.1
batch_size: 4
use_layer_norm: True
use_batch_norm: True
eps: 1e-08
init_std: 0.02
electrode_names: ['Fp1', 'Fp2', 'F3', 'F4', 'F7', 'F8', 'Fz', 'C3', 'C4', 'Cz', 'P3', 'P4', 'P7', 'P8', 'Pz', 'O1', 'O2', 'Oz', 'T3', 'T4', 'T5', 'T6']
region_names: ['frontal', 'central', 'parietal', 'temporal', 'occipital']
debug: False
freq_eval: True
use_channel_embed: True
channel_embed_dim: 32
num_brain_regions: 5
channel_gat_initial_dim: 32
intra_region_gat_heads: 4
intra_region_gat_dim_per_head: 32
region_agg_attention_dim: 64
inter_region_gat_heads: 4
inter_region_gat_dim_per_head: 64
模型已创建并移动到设备: cuda:0
模型已使用DDP封装在设备 0
优化器已创建，学习率: 0.0001
DDP训练，世界大小: 8, 有效批次大小: 32
动态梯度累积设置:
  目标全局批次大小: 128
  当前全局批次大小: 32
  梯度累积步数: 4
  实际有效全局批次大小: 128
训练器已创建

============================================================
                           模型参数统计                           
============================================================
总参数量:                2,204,710,800
可训练参数:               2,204,710,800
冻结参数:                0
参数大小:                8410.30 MB (FP32)
参数大小:                4205.15 MB (FP16)

------------------------------------------------------------
                          主要模块参数分布                          
------------------------------------------------------------
region_projection.raw_projection.0        2,459,136 (  0.1%)
fusion_module.mlp_t.0                     2,362,368 (  0.1%)
fusion_module.mlp_f.0                     2,362,368 (  0.1%)
layers.0.mlp.experts.0.0                  2,362,368 (  0.1%)
layers.0.mlp.experts.1.0                  2,362,368 (  0.1%)
layers.0.mlp.experts.2.0                  2,362,368 (  0.1%)
layers.0.mlp.experts.3.0                  2,362,368 (  0.1%)
layers.0.mlp.experts.4.0                  2,362,368 (  0.1%)
layers.0.mlp.experts.5.0                  2,362,368 (  0.1%)
layers.0.mlp.experts.6.0                  2,362,368 (  0.1%)
其他模块                                     2,177,446,026 ( 98.8%)
============================================================

正在加载数据: /home/hk-project-p0022560/tum_fmp0582/ict/bfm_iclr/processed_data1
数据集初始化完成: 共4289个文件, 总样本数: 4508290
数据加载器已创建: 样本数=4508290, 批次大小=4
数据加载器已创建: 样本数=4508290, 批次大小=4
数据加载器已创建: 样本数=4508290, 批次大小=4
数据加载器已创建: 样本数=4508290, 批次大小=4
数据集初始化完成: 共4289个文件, 总样本数: 4508290
数据加载器已创建: 样本数=4508290, 批次大小=4
数据加载器已创建: 样本数=4508290, 批次大小=4

==================================================
开始训练 DualDomain Neural Transformer MEM 模型
共100个周期，批次大小:4
==================================================

学习率调度器已初始化，总训练epochs: 100, 每个epoch的步数: 140884
总训练步数: 14088400
学习率调度器设置成功
数据加载器已创建: 样本数=4508290, 批次大小=4
警告: 未找到TensorBoard，将不会记录训练日志

==================================================
     DualDomain Neural Transformer MEM 模型训练开始     
==================================================
                     本次运行文件夹                      
--------------------------------------------------
运行文件夹:          checkpoint/20250724_174402
最佳模型:           checkpoint/20250724_174402/best_model.pt
最后模型:           checkpoint/20250724_174402/last_model.pt
--------------------------------------------------
                      模型参数统计                      
--------------------------------------------------
总参数量:           2,204,710,800
可训练参数:          2,204,710,800
冻结参数:           0
内存占用(FP32):     8410.3 MB
内存占用(FP16):     4205.2 MB

                     主要组件参数分布                     
--------------------------------------------------
layers               2,182,161,408 ( 99.0%)
fusion_module          15,357,696 (  0.7%)
region_projection       4,606,470 (  0.2%)
time_reconstruction_head1    1,230,400 (  0.1%)
time_reconstruction_head2    1,230,400 (  0.1%)
positional_embedding       92,160 (  0.0%)
intra_region_pos_embedding       18,432 (  0.0%)
freq_reconstruction_head1        3,845 (  0.0%)
freq_reconstruction_head2        3,845 (  0.0%)
region_embedding            3,840 (  0.0%)
norm                        1,536 (  0.0%)

                      训练配置信息                      
--------------------------------------------------
训练周期:           100
批次大小:           4
有效批次大小:         32
设备:             cuda:0
DDP世界大小:        8
DDP模式:          启用
学习率:            0.0001
时域损失权重:         0.9
频域损失权重:         0.1
混合精度:           启用
梯度累积步数:         4
每个周期的步数:        140884
==================================================


Epoch 1/100
--------------------------------------------------
数据加载器已创建: 样本数=4508290, 批次大小=4
序列长度 (R*E): 120
时域预测形状: torch.Size([4, 120, 1600]), 目标形状: torch.Size([4, 120, 1600])
频域预测形状: torch.Size([4, 120, 5]), 目标形状: torch.Size([4, 120, 5])
训练进度: [=                   ] 1/140884 | 总损失: 0.79164910 | 时域: 0.74685204 | 频域: 3.60343695 | LR: 0.00000200 | 用时: 3.3秒训练进度: [=                   ] 7045/140884 | 总损失: 0.22426388 | 时域: 0.11550805 | 频域: 1.55496764 | LR: 0.00000200 | 用时: 8064.3秒训练进度: [==                  ] 14089/140884 | 总损失: 0.25415239 | 时域: 0.20215203 | 频域: 1.52405405 | LR: 0.00000200 | 用时: 16137.5秒训练进度: [===                 ] 21133/140884 | 总损失: 0.19664821 | 时域: 0.10748374 | 频域: 0.95749509 | LR: 0.00000200 | 用时: 24201.1秒训练进度: [====                ] 28177/140884 | 总损失: 0.20242287 | 时域: 0.10450087 | 频域: 1.14241910 | LR: 0.00000200 | 用时: 32236.8秒训练进度: [=====               ] 35221/140884 | 总损失: 0.20278843 | 时域: 0.11382837 | 频域: 1.06984663 | LR: 0.00000200 | 用时: 40267.3秒训练进度: [======              ] 42265/140884 | 总损失: 0.20198871 | 时域: 0.11887500 | 频域: 1.00332475 | LR: 0.00000200 | 用时: 48302.1秒训练进度: [=======             ] 49309/140884 | 总损失: 0.20212758 | 时域: 0.09811004 | 频域: 1.19084597 | LR: 0.00000200 | 用时: 56333.9秒训练进度: [========            ] 56353/140884 | 总损失: 0.18576244 | 时域: 0.09169368 | 频域: 0.84230787 | LR: 0.00000200 | 用时: 64365.4秒训练进度: [=========           ] 63397/140884 | 总损失: 0.18997486 | 时域: 0.09729269 | 频域: 0.90080571 | LR: 0.00000200 | 用时: 72395.7秒训练进度: [==========          ] 70441/140884 | 总损失: 0.23690715 | 时域: 0.19961181 | 频域: 1.14261699 | LR: 0.00000200 | 用时: 80428.2秒训练进度: [===========         ] 77485/140884 | 总损失: 0.23114598 | 时域: 0.20985530 | 频域: 0.92064857 | LR: 0.00000200 | 用时: 88458.9秒训练进度: [============        ] 84529/140884 | 总损失: 0.21122003 | 时域: 0.16874683 | 频域: 0.78084958 | LR: 0.00000200 | 用时: 96493.5秒训练进度: [=============       ] 91573/140884 | 总损失: 0.19453056 | 时域: 0.12461275 | 频域: 0.77359545 | LR: 0.00000200 | 用时: 104529.0秒训练进度: [==============      ] 98617/140884 | 总损失: 0.19325548 | 时域: 0.11685804 | 频域: 0.80115038 | LR: 0.00000200 | 用时: 112561.1秒训练进度: [===============     ] 105661/140884 | 总损失: 0.20165329 | 时域: 0.14590436 | 频域: 0.76243889 | LR: 0.00000200 | 用时: 120592.8秒训练进度: [================    ] 112705/140884 | 总损失: 0.18119231 | 时域: 0.08932793 | 频域: 0.75234139 | LR: 0.00000200 | 用时: 128622.9秒训练进度: [=================   ] 119749/140884 | 总损失: 0.20326418 | 时域: 0.15644923 | 频域: 0.70705557 | LR: 0.00000200 | 用时: 136653.7秒训练进度: [==================  ] 126793/140884 | 总损失: 0.19508410 | 时域: 0.14591199 | 频域: 0.59505713 | LR: 0.00000200 | 用时: 144691.8秒训练进度: [=================== ] 133837/140884 | 总损失: 0.17869854 | 时域: 0.09411192 | 频域: 0.65980351 | LR: 0.00000201 | 用时: 152726.2秒训练进度: [====================] 140881/140884 | 总损失: 0.21243103 | 时域: 0.17028244 | 频域: 0.81453693 | LR: 0.00000201 | 用时: 160760.4秒训练进度: [====================] 140884/140884 | 总损失: 0.16887665 | 时域: 0.08009052 | 频域: 0.52988291 | LR: 0.00000201 | 用时: 160763.9秒
--------------------------------------------------
                     Epoch 总结                     
训练总损失:          0.21413827
训练时域损失:         0.15607681
训练频域损失:         0.95367721
训练相位损失:         0.19381516
当前学习率:          0.00000201
本轮用时:           160764.0秒
--------------------------------------------------

Epoch 2/100
--------------------------------------------------
slurmstepd: error: *** STEP 3372647.0 ON hkn0904 CANCELLED AT 2025-07-26T17:42:41 DUE TO TIME LIMIT ***
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
srun: got SIGCONT

============================= JOB FEEDBACK =============================

Job ID: 3372647
Cluster: hk
User/Group: tum_fmp0582/hk-project-p0022560
Account: hk-project-p0022560
State: TIMEOUT (exit code 0)
Partition: accelerated-h100
Nodes: 2
Cores per node: 128
Nodelist: hkn[0904,0908]
CPU Utilized: 20-15:39:31
CPU Efficiency: 4.03% of 512-00:51:12 core-walltime
Job Wall-clock time: 2-00:00:12
Starttime: Thu Jul 24 17:42:29 2025
Endtime: Sat Jul 26 17:42:41 2025
Memory Utilized: 79.97 GB (estimated maximum)
Memory Efficiency: 0.00% of 0.00 MB (0.00 MB/node)
Energy Consumed: 463275814 Joule / 128687.726111111 Watthours
Average node power draw: 2680.80812675046 Watt
