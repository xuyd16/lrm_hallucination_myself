Thu Jul 24 15:09:05 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.133.20             Driver Version: 570.133.20     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA A100-SXM4-40GB          On  |   00000000:31:00.0 Off |                    0 |
| N/A   44C    P0             58W /  300W |      27MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   1  NVIDIA A100-SXM4-40GB          On  |   00000000:4B:00.0 Off |                    0 |
| N/A   44C    P0             55W /  300W |      27MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   2  NVIDIA A100-SXM4-40GB          On  |   00000000:CA:00.0 Off |                    0 |
| N/A   44C    P0             53W /  300W |      27MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
|   3  NVIDIA A100-SXM4-40GB          On  |   00000000:E3:00.0 Off |                    0 |
| N/A   44C    P0             53W /  300W |      27MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|    0   N/A  N/A            2532      G   /usr/libexec/Xorg                        17MiB |
|    1   N/A  N/A            2532      G   /usr/libexec/Xorg                        17MiB |
|    2   N/A  N/A            2532      G   /usr/libexec/Xorg                        17MiB |
|    3   N/A  N/A            2532      G   /usr/libexec/Xorg                        17MiB |
+-----------------------------------------------------------------------------------------+
=== BFM EEG Pre-training Job Started ===
Job started on hkn0517.localdomain at Thu Jul 24 03:09:07 PM CEST 2025
Current working directory: /home/hk-project-p0022560/tum_fmp0582/ict/bfm_iclr
Job ID: 3372646
Master Addr: hkn0517
Master Port: 29500
=== Environment Setup Complete ===
CUDA available: True
GPU count: 4
=== Starting EEG Model Pre-training ===
GpuFreq=control_disabled
GpuFreq=control_disabled
DDP初始化成功: rank=0, local_rank=0, world_size=8
使用设备: cuda:0
可用GPU数量: 4
  GPU 0: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 1: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 2: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB
  GPU 3: NVIDIA A100-SXM4-40GB
    显存: 39.5 GB

=== 模型配置信息 ===
num_regions: 5
max_electrodes_per_region: 24
sequence_length: 1600
embed_dim: 512
num_heads: 16
depth: 26
mlp_ratio: 4.0
drop_rate: 0.2
attn_drop_rate: 0.2
drop_path_rate: 0.2
use_abs_pos: False
use_rel_pos: True
use_time_embed: True
mask_ratio: 0.15
freq_mask_ratio: 0.3
mask_strategy: random
mask_noise_ratio: 0.005
use_moe: True
num_experts: 16
top_k_experts: 2
moe_aux_loss_coeff: 0.01
n_freq_bands: 5
freq_loss_weight: 0.1
time_loss_weight: 0.9
lr: 0.0001
weight_decay: 0.0001
warmup_epochs: 5
use_amp: True
clip_grad: 0.1
batch_size: 16
use_layer_norm: True
use_batch_norm: True
eps: 1e-08
init_std: 0.02
electrode_names: ['Fp1', 'Fp2', 'F3', 'F4', 'F7', 'F8', 'Fz', 'C3', 'C4', 'Cz', 'P3', 'P4', 'P7', 'P8', 'Pz', 'O1', 'O2', 'Oz', 'T3', 'T4', 'T5', 'T6']
region_names: ['frontal', 'central', 'parietal', 'temporal', 'occipital']
debug: False
freq_eval: True
use_channel_embed: True
channel_embed_dim: 32
num_brain_regions: 5
channel_gat_initial_dim: 32
intra_region_gat_heads: 4
intra_region_gat_dim_per_head: 32
region_agg_attention_dim: 64
inter_region_gat_heads: 4
inter_region_gat_dim_per_head: 64
模型已创建并移动到设备: cuda:0
模型已使用DDP封装在设备 0
优化器已创建，学习率: 0.0001
DDP训练，世界大小: 8, 有效批次大小: 128
动态梯度累积设置:
  目标全局批次大小: 128
  当前全局批次大小: 128
  梯度累积步数: 1
  实际有效全局批次大小: 128
训练器已创建

============================================================
                           模型参数统计                           
============================================================
总参数量:                912,173,712
可训练参数:               912,173,712
冻结参数:                0
参数大小:                3479.67 MB (FP32)
参数大小:                1739.83 MB (FP16)

------------------------------------------------------------
                          主要模块参数分布                          
------------------------------------------------------------
region_projection.raw_projection.0        1,639,424 (  0.2%)
fusion_module.mlp_t.0                     1,050,624 (  0.1%)
fusion_module.mlp_f.0                     1,050,624 (  0.1%)
layers.0.mlp.experts.0.0                  1,050,624 (  0.1%)
layers.0.mlp.experts.1.0                  1,050,624 (  0.1%)
layers.0.mlp.experts.2.0                  1,050,624 (  0.1%)
layers.0.mlp.experts.3.0                  1,050,624 (  0.1%)
layers.0.mlp.experts.4.0                  1,050,624 (  0.1%)
layers.0.mlp.experts.5.0                  1,050,624 (  0.1%)
layers.0.mlp.experts.6.0                  1,050,624 (  0.1%)
其他模块                                     899,502,218 ( 98.6%)
============================================================

正在加载数据: /home/hk-project-p0022560/tum_fmp0582/ict/bfm_iclr/processed_data1
数据集初始化完成: 共4289个文件, 总样本数: 4508290
数据加载器已创建: 样本数=4508290, 批次大小=16
数据加载器已创建: 样本数=4508290, 批次大小=16
数据加载器已创建: 样本数=4508290, 批次大小=16
数据集初始化完成: 共4289个文件, 总样本数: 4508290
数据加载器已创建: 样本数=4508290, 批次大小=16

==================================================
开始训练 DualDomain Neural Transformer MEM 模型
共100个周期，批次大小:16
==================================================

学习率调度器已初始化，总训练epochs: 100, 每个epoch的步数: 35221
总训练步数: 3522100
学习率调度器设置成功
警告: 未找到TensorBoard，将不会记录训练日志

==================================================
     DualDomain Neural Transformer MEM 模型训练开始     
==================================================
                     本次运行文件夹                      
--------------------------------------------------
运行文件夹:          checkpoint/20250724_150948
最佳模型:           checkpoint/20250724_150948/best_model.pt
最后模型:           checkpoint/20250724_150948/last_model.pt
--------------------------------------------------
                      模型参数统计                      
--------------------------------------------------
总参数量:           912,173,712
可训练参数:          912,173,712
冻结参数:           0
内存占用(FP32):     3479.7 MB
内存占用(FP16):     1739.8 MB

                     主要组件参数分布                     
--------------------------------------------------
layers                901,022,720 ( 98.8%)
fusion_module           6,830,592 (  0.7%)
region_projection       2,595,846 (  0.3%)
time_reconstruction_head1      820,800 (  0.1%)
time_reconstruction_head2      820,800 (  0.1%)
positional_embedding       61,440 (  0.0%)
intra_region_pos_embedding       12,288 (  0.0%)
freq_reconstruction_head1        2,565 (  0.0%)
freq_reconstruction_head2        2,565 (  0.0%)
region_embedding            2,560 (  0.0%)
norm                        1,024 (  0.0%)

                      训练配置信息                      
--------------------------------------------------
训练周期:           100
批次大小:           16
有效批次大小:         128
设备:             cuda:0
DDP世界大小:        8
DDP模式:          启用
学习率:            0.0001
时域损失权重:         0.9
频域损失权重:         0.1
混合精度:           启用
梯度累积步数:         1
每个周期的步数:        35221
==================================================


Epoch 1/100
--------------------------------------------------
数据加载器已创建: 样本数=4508290, 批次大小=16
数据加载器已创建: 样本数=4508290, 批次大小=16
数据加载器已创建: 样本数=4508290, 批次大小=16
数据加载器已创建: 样本数=4508290, 批次大小=16
序列长度 (R*E): 120
时域预测形状: torch.Size([16, 120, 1600]), 目标形状: torch.Size([16, 120, 1600])
频域预测形状: torch.Size([16, 120, 5]), 目标形状: torch.Size([16, 120, 5])
训练进度: [=                   ] 1/35221 | 总损失: 0.17406300 | 时域: 0.62849689 | 频域: 3.38481569 | LR: 0.00000200 | 用时: 4.7秒训练进度: [=                   ] 1762/35221 | 总损失: 0.05376852 | 时域: 0.11640161 | 频域: 1.49573302 | LR: 0.00000200 | 用时: 2713.1秒训练进度: [==                  ] 3523/35221 | 总损失: 0.06004728 | 时域: 0.18686941 | 频域: 1.52385449 | LR: 0.00000200 | 用时: 5416.0秒训练进度: [===                 ] 5284/35221 | 总损失: 0.05741758 | 时域: 0.17806408 | 频域: 1.34912443 | LR: 0.00000200 | 用时: 8110.1秒训练进度: [====                ] 7045/35221 | 总损失: 0.05193584 | 时域: 0.13066824 | 频域: 1.22954750 | LR: 0.00000200 | 用时: 10808.7秒训练进度: [=====               ] 8806/35221 | 总损失: 0.04790548 | 时域: 0.10886465 | 频域: 1.03344250 | LR: 0.00000201 | 用时: 13502.9秒训练进度: [======              ] 10567/35221 | 总损失: 0.04750691 | 时域: 0.10633062 | 频域: 1.02445292 | LR: 0.00000201 | 用时: 16188.3秒训练进度: [=======             ] 12328/35221 | 总损失: 0.04578212 | 时域: 0.09388381 | 频域: 0.95712405 | LR: 0.00000201 | 用时: 18881.7秒训练进度: [========            ] 14089/35221 | 总损失: 0.04987813 | 时域: 0.13178380 | 频域: 1.02839255 | LR: 0.00000202 | 用时: 21571.8秒训练进度: [=========           ] 15850/35221 | 总损失: 0.04653029 | 时域: 0.10770738 | 频域: 0.91266537 | LR: 0.00000202 | 用时: 24266.7秒训练进度: [==========          ] 17611/35221 | 总损失: 0.05002022 | 时域: 0.13583890 | 频域: 1.00380361 | LR: 0.00000202 | 用时: 26949.4秒训练进度: [===========         ] 19372/35221 | 总损失: 0.04997774 | 时域: 0.14500701 | 频域: 0.92503476 | LR: 0.00000203 | 用时: 29635.9秒训练进度: [============        ] 21133/35221 | 总损失: 0.06072048 | 时域: 0.25663486 | 频域: 0.99952102 | LR: 0.00000203 | 用时: 32313.2秒训练进度: [=============       ] 22894/35221 | 总损失: 0.04673037 | 时域: 0.11917275 | 频域: 0.83348000 | LR: 0.00000204 | 用时: 34995.6秒训练进度: [==============      ] 24655/35221 | 总损失: 0.05835216 | 时域: 0.24620765 | 频域: 0.84381092 | LR: 0.00000205 | 用时: 37681.5秒训练进度: [===============     ] 26416/35221 | 总损失: 0.04536583 | 时域: 0.10476973 | 频域: 0.82929254 | LR: 0.00000205 | 用时: 40364.1秒训练进度: [================    ] 28177/35221 | 总损失: 0.04348875 | 时域: 0.08652864 | 频域: 0.79967892 | LR: 0.00000206 | 用时: 43049.3秒训练进度: [=================   ] 29938/35221 | 总损失: 0.04501483 | 时域: 0.11247855 | 频域: 0.73312610 | LR: 0.00000207 | 用时: 45734.9秒训练进度: [==================  ] 31699/35221 | 总损失: 0.04863827 | 时域: 0.15594354 | 频域: 0.70072901 | LR: 0.00000208 | 用时: 48417.2秒训练进度: [=================== ] 33460/35221 | 总损失: 0.04595446 | 时域: 0.11188546 | 频域: 0.82543248 | LR: 0.00000209 | 用时: 51106.2秒训练进度: [====================] 35221/35221 | 总损失: 0.05497702 | 时域: 0.20730597 | 频域: 0.86513901 | LR: 0.00000210 | 用时: 53792.1秒
--------------------------------------------------
                     Epoch 总结                     
训练总损失:          0.05252005
训练时域损失:         0.15792367
训练频域损失:         1.02670992
训练相位损失:         0.20023161
当前学习率:          0.00000210
本轮用时:           53792.2秒
--------------------------------------------------

Epoch 2/100
--------------------------------------------------
训练进度: [=                   ] 1/35221 | 总损失: 0.04594979 | 时域: 0.11433698 | 频域: 0.80326962 | LR: 0.00000210 | 用时: 2.9秒训练进度: [=                   ] 1762/35221 | 总损失: 0.04415550 | 时域: 0.10710544 | 频域: 0.68811524 | LR: 0.00000211 | 用时: 2707.7秒训练进度: [==                  ] 3523/35221 | 总损失: 0.04368216 | 时域: 0.10111494 | 频域: 0.69577980 | LR: 0.00000212 | 用时: 5407.5秒训练进度: [===                 ] 5284/35221 | 总损失: 0.04691792 | 时域: 0.14615870 | 频域: 0.61850399 | LR: 0.00000213 | 用时: 8120.0秒训练进度: [====                ] 7045/35221 | 总损失: 0.04607658 | 时域: 0.12052744 | 频域: 0.76138806 | LR: 0.00000214 | 用时: 10829.6秒训练进度: [=====               ] 8806/35221 | 总损失: 0.04301434 | 时域: 0.10359427 | 频域: 0.60433793 | LR: 0.00000215 | 用时: 13544.2秒训练进度: [======              ] 10567/35221 | 总损失: 0.04228369 | 时域: 0.09045741 | 频域: 0.65401542 | LR: 0.00000216 | 用时: 16253.2秒训练进度: [=======             ] 12328/35221 | 总损失: 0.04308363 | 时域: 0.10116003 | 频域: 0.63959408 | LR: 0.00000218 | 用时: 18964.6秒训练进度: [========            ] 14089/35221 | 总损失: 0.04787507 | 时域: 0.14917719 | 频域: 0.68117613 | LR: 0.00000219 | 用时: 21679.0秒训练进度: [=========           ] 15850/35221 | 总损失: 0.04150990 | 时域: 0.09078838 | 频域: 0.57360661 | LR: 0.00000220 | 用时: 24388.4秒训练进度: [==========          ] 17611/35221 | 总损失: 0.04337005 | 时域: 0.09989446 | 频域: 0.68320644 | LR: 0.00000222 | 用时: 27096.6秒训练进度: [===========         ] 19372/35221 | 总损失: 0.05100575 | 时域: 0.20060667 | 频域: 0.53435773 | LR: 0.00000223 | 用时: 29801.9秒训练进度: [============        ] 21133/35221 | 总损失: 0.03993798 | 时域: 0.07958592 | 频域: 0.52822548 | LR: 0.00000225 | 用时: 32511.8秒训练进度: [=============       ] 22894/35221 | 总损失: 0.04936742 | 时域: 0.17399809 | 频域: 0.61298680 | LR: 0.00000226 | 用时: 35219.8秒训练进度: [==============      ] 24655/35221 | 总损失: 0.04734359 | 时域: 0.14901346 | 频域: 0.63131976 | LR: 0.00000228 | 用时: 37925.4秒训练进度: [===============     ] 26416/35221 | 总损失: 0.04348464 | 时域: 0.11390679 | 频域: 0.56911772 | LR: 0.00000230 | 用时: 40637.9秒训练进度: [================    ] 28177/35221 | 总损失: 0.05179663 | 时域: 0.20168704 | 频域: 0.60138488 | LR: 0.00000231 | 用时: 43342.1秒训练进度: [=================   ] 29938/35221 | 总损失: 0.04212875 | 时域: 0.10106428 | 频域: 0.54396081 | LR: 0.00000233 | 用时: 46050.4秒训练进度: [==================  ] 31699/35221 | 总损失: 0.05796916 | 时域: 0.27348953 | 频域: 0.57980138 | LR: 0.00000235 | 用时: 48754.2秒训练进度: [=================== ] 33460/35221 | 总损失: 0.04572741 | 时域: 0.14458020 | 频域: 0.51569211 | LR: 0.00000237 | 用时: 51468.6秒训练进度: [====================] 35221/35221 | 总损失: 0.04460974 | 时域: 0.12757231 | 频域: 0.54807740 | LR: 0.00000239 | 用时: 54175.9秒
--------------------------------------------------
                     Epoch 总结                     
训练总损失:          0.04724843
训练时域损失:         0.14902360
训练频域损失:         0.62326259
训练相位损失:         0.16993237
当前学习率:          0.00000239
本轮用时:           54176.0秒
--------------------------------------------------

Epoch 3/100
--------------------------------------------------
训练进度: [=                   ] 1/35221 | 总损失: 0.05522956 | 时域: 0.24745116 | 频域: 0.53960347 | LR: 0.00000239 | 用时: 2.8秒训练进度: [=                   ] 1762/35221 | 总损失: 0.04332419 | 时域: 0.12100047 | 频域: 0.48727247 | LR: 0.00000241 | 用时: 2713.1秒训练进度: [==                  ] 3523/35221 | 总损失: 0.04002258 | 时域: 0.09177055 | 频域: 0.42541546 | LR: 0.00000243 | 用时: 5419.9秒训练进度: [===                 ] 5284/35221 | 总损失: 0.04372597 | 时域: 0.12417206 | 频域: 0.49940309 | LR: 0.00000245 | 用时: 8121.7秒训练进度: [====                ] 7045/35221 | 总损失: 0.04455824 | 时域: 0.13136184 | 频域: 0.52096206 | LR: 0.00000247 | 用时: 10822.1秒训练进度: [=====               ] 8806/35221 | 总损失: 0.04425552 | 时域: 0.13009641 | 频域: 0.49828467 | LR: 0.00000249 | 用时: 13526.2秒训练进度: [======              ] 10567/35221 | 总损失: 0.04522913 | 时域: 0.14352456 | 频域: 0.47573549 | LR: 0.00000251 | 用时: 16218.6秒训练进度: [=======             ] 12328/35221 | 总损失: 0.05025152 | 时域: 0.18988520 | 频域: 0.56440616 | LR: 0.00000253 | 用时: 18909.0秒训练进度: [========            ] 14089/35221 | 总损失: 0.04141544 | 时域: 0.10568233 | 频域: 0.43413645 | LR: 0.00000256 | 用时: 21604.4秒训练进度: [=========           ] 15850/35221 | 总损失: 0.04642698 | 时域: 0.15377626 | 频域: 0.50959897 | LR: 0.00000258 | 用时: 24298.2秒训练进度: [==========          ] 17611/35221 | 总损失: 0.04245435 | 时域: 0.11077757 | 频域: 0.49545836 | LR: 0.00000260 | 用时: 27004.2秒训练进度: [===========         ] 19372/35221 | 总损失: 0.04273132 | 时域: 0.11757372 | 频域: 0.46042487 | LR: 0.00000263 | 用时: 29710.0秒训练进度: [============        ] 21133/35221 | 总损失: 0.04185219 | 时域: 0.11090410 | 频域: 0.43104765 | LR: 0.00000265 | 用时: 32414.5秒训练进度: [=============       ] 22894/35221 | 总损失: 0.04475065 | 时域: 0.13372800 | 频域: 0.51849771 | LR: 0.00000268 | 用时: 35119.6秒训练进度: [==============      ] 24655/35221 | 总损失: 0.04312028 | 时域: 0.13322772 | 频域: 0.36386794 | LR: 0.00000270 | 用时: 37817.4秒训练进度: [===============     ] 26416/35221 | 总损失: 0.05039228 | 时域: 0.20065191 | 频域: 0.48064616 | LR: 0.00000273 | 用时: 40515.7秒训练进度: [================    ] 28177/35221 | 总损失: 0.04365593 | 时域: 0.13000003 | 频域: 0.44082072 | LR: 0.00000276 | 用时: 43220.2秒训练进度: [=================   ] 29938/35221 | 总损失: 0.04798400 | 时域: 0.17606741 | 频域: 0.46076518 | LR: 0.00000278 | 用时: 45922.5秒训练进度: [==================  ] 31699/35221 | 总损失: 0.04383746 | 时域: 0.13219807 | 频域: 0.44347346 | LR: 0.00000281 | 用时: 48627.7秒训练进度: [=================== ] 33460/35221 | 总损失: 0.04171079 | 时域: 0.10963345 | 频域: 0.42825076 | LR: 0.00000284 | 用时: 51323.6秒训练进度: [====================] 35221/35221 | 总损失: 0.04049566 | 时域: 0.09662193 | 频域: 0.42316347 | LR: 0.00000287 | 用时: 54022.8秒
--------------------------------------------------
                     Epoch 总结                     
训练总损失:          0.04549281
训练时域损失:         0.14829528
训练频域损失:         0.46091113
训练相位损失:         0.16754850
当前学习率:          0.00000287
本轮用时:           54022.9秒
--------------------------------------------------

Epoch 4/100
--------------------------------------------------
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
slurmstepd: error: *** STEP 3372646.0 ON hkn0517 CANCELLED AT 2025-07-26T15:08:39 DUE TO TIME LIMIT ***
srun: got SIGCONT

============================= JOB FEEDBACK =============================

Job ID: 3372646
Cluster: hk
User/Group: tum_fmp0582/hk-project-p0022560
Account: hk-project-p0022560
State: TIMEOUT (exit code 0)
Partition: accelerated
Nodes: 2
Cores per node: 128
Nodelist: hkn[0517,0531]
CPU Utilized: 17-04:14:52
CPU Efficiency: 3.35% of 512-00:12:48 core-walltime
Job Wall-clock time: 2-00:00:03
Starttime: Thu Jul 24 15:08:36 2025
Endtime: Sat Jul 26 15:08:39 2025
Memory Utilized: 47.73 GB (estimated maximum)
Memory Efficiency: 0.00% of 0.00 MB (0.00 MB/node)
Energy Consumed: 305101418 Joule / 84750.3938888889 Watthours
Average node power draw: 1765.60255319641 Watt
